<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-09-17 Mon 07:26 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Postmodern</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="style.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Postmodern</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9243c9e">Dependencies</a></li>
<li><a href="#org712793a">License</a></li>
<li><a href="#org9da2b12">Download and installation</a></li>
<li><a href="#org9c38027">Quickstart</a></li>
<li><a href="#orge0801c7">Reference</a></li>
<li><a href="#org5e002d5">Caveats and to-dos</a>
<ul>
<li><a href="#org126da9c">Timezones</a></li>
<li><a href="#orgc1f27e8">Portability</a></li>
<li><a href="#org65e70b6">Things that should be implemented</a></li>
</ul>
</li>
<li><a href="#org90487a1">Resources</a></li>
</ul>
</div>
</div>
<p>
Postmodern is a Common Lisp library for interacting with <a href="https://postgresql.org">PostgreSQL databases</a>.
Features are:
</p>

<ul class="org-ul">
<li>Efficient communication with the database server without need for foreign libraries.</li>
<li>Support for UTF-8 on Unicode-aware Lisp implementations</li>
<li>A syntax for mixing SQL and Lisp code</li>
<li>Convenient support for prepared statements and stored procedures</li>
<li>A metaclass for simple database-access objects</li>
</ul>

<p>
The biggest differences between this library and <a href="http://quickdocs.org/clsql/">clsql</a> or <a href="https://github.com/fukamachi/cl-dbi">cl-dbi</a>
are that Postmodern has no intention of being portable across different SQL
implementations (it embraces non-standard PostgreSQL features), and approaches
extensions like lispy SQL and database access objects in a quite different way.
This library was written because the CLSQL approach did not really work for
me, your mileage may vary.
</p>


<div id="outline-container-org9243c9e" class="outline-2">
<h2 id="org9243c9e">Dependencies</h2>
<div class="outline-text-2" id="text-org9243c9e">
<p>
The library depends on <a href="http://quickdocs.org/usocket/">usocket</a> (except on <a href="http://sbcl.org/">SBCL</a> and <a href="https://franz.com/products/allegrocl/">ACL</a>, where the built-in
socket library is used), <a href="https://github.com/pmai/md5.git">md5</a>, <a href="https://github.com/pcostanza/closer-mop.git">closer-mop</a>, <a href="https://github.com/sionescu/bordeaux-threads.git">bordeaux-threads</a> if you want
thread-safe connection pools, and <a href="https://github.com/cl-plus-ssl/cl-plus-ssl.git">CL+SSL</a> when SSL connections are needed.
</p>

<p>
Postmodern itself is split into four different packages, some of which
can be used independently. <a href="simple-date.html">Simple-date</a> is a very basic implementation of
date and time objects, used to support storing and retrieving time-related
SQL types. <a href="cl-postgres.html">CL-postgres</a> is the low-level library used for interfacing with a
PostgreSQL server over a socket. <a href="s-sql.html">S-SQL</a> is used to compile s-expressions to
strings of SQL code, escaping any Lisp values inside, and doing as much as
possible of the work at compile time. Finally, <a href="postmodern.html">Postmodern</a> itself is the
library that tries to put all these things together into a convenient
programming interface.
</p>
</div>
</div>

<div id="outline-container-org712793a" class="outline-2">
<h2 id="org712793a">License</h2>
<div class="outline-text-2" id="text-org712793a">
<p>
Postmodern is released under a zlib-style license. Which approximately
means you can use the code in whatever way you like, except for passing
it off as your own or releasing a modified version without indication
that it is not the original.</p>
<p>The functions execute-file.lisp were ported from [[https://github.com/dimitri/pgloader][pgloader]] with grateful thanks to
Dimitri Fontaine and are released under a BSD-3 license.
</p>
</div>
</div>

<div id="outline-container-org9da2b12" class="outline-2">
<h2 id="org9da2b12">Download and installation</h2>
<div class="outline-text-2" id="text-org9da2b12">
<p>
We suggest using <a href="https://quicklisp.org">quicklisp.org</a> for installation.
</p>

<p>
A git repository with the most recent changes can be viewed or checked out at:
</p>

<p>
&gt; git clone <a href="https://github.com/marijnh/Postmodern">https://github.com/marijnh/Postmodern</a>
</p>
</div>
</div>

<div id="outline-container-org9c38027" class="outline-2">
<h2 id="org9c38027">Quickstart</h2>
<div class="outline-text-2" id="text-org9c38027">
<p>
This quickstart is intended to give you a feel of the way coding with
Postmodern works. Further details about the workings of the library
can be found in the reference manuals linked below.
</p>

<p>
Assuming you have already installed quicklisp, load postmodern.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(ql:quickload :postmodern)
(use-package :postmodern)
</pre>
</div>

<p>
If you have a PostgreSQL server running on localhost, with a database
called 'testdb' on it, which is accessible for user 'foucault' with
password 'surveiller', you can connect like this:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(connect-toplevel "testdb" "foucault" "surveiller" "localhost")
</pre>
</div>

<p>
Which will establish a connection to be used by all code, except for that
wrapped in a with-connection form, which takes the same arguments but only
establishes the connection locally.
</p>

<p>
Now for a basic sanity test:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(query "select 22, 'Folie et déraison', 4.5")
;; =&gt; ((22 "Folie et déraison" 9/2))
</pre>
</div>

<p>
That should work. query is the basic way to send queries to the database.
The same query can be expressed like this:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(query (:select 22 "Folie et déraison" 4.5))
;; =&gt; ((22 "Folie et déraison" 9/2))
</pre>
</div>

<p>
In many contexts, query strings and lists starting with keywords can be used
interchangeably. The lists will be compiled to SQL. The S-SQL manual describes
the syntax used by these expressions. Lisp values occurring in them are
automatically escaped. In the above query, only constant values are used, but
it is possible to transparently use run-time values as well:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(defun database-powered-addition (a b)
  (query (:select (:+ a b)) :single))

(database-powered-addition 1030 204)
;; =&gt; 1234
</pre>
</div>

<p>
That last argument, :single, indicates that we want the result not as a list
of lists (for the result rows), but as a single value, since we know that we
are only selecting one value. Some other options are :rows, :row, :column, :alists,
and :none. Their precise effect is documented in the reference manual.
</p>

<p>
You do not have to pull in the whole result of a query at once, you can
also iterate over it with the doquery macro:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(doquery (:select 'x 'y :from 'some-imaginary-table) (x y)
  (format t "On this row, x = ~A and y = ~A.~%" x y))
</pre>
</div>

<p>
You can work directly with the database or you can use a database-access-class (aka dao).
This is what a database-access class looks like:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(defclass country ()
  ((name :col-type string :initarg :name
         :reader country-name)
   (inhabitants :col-type integer :initarg :inhabitants
                :accessor country-inhabitants)
   (sovereign :col-type (or db-null string) :initarg :sovereign
              :accessor country-sovereign))
  (:metaclass dao-class)
  (:keys name))
</pre>
</div>

<p>
The above defines a class that can be used to handle records in a table with
three columns: name, inhabitants, and sovereign. In simple cases, the
information above is enough to define the table as well:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(dao-table-definition 'country)
;; =&gt; "CREATE TABLE country (
;;      name TEXT NOT NULL,
;;      inhabitants INTEGER NOT NULL,
;;      sovereign TEXT,
;;      PRIMARY KEY (name))"

(execute (dao-table-definition 'country))
</pre>
</div>

<p>
This defines our table in the database. execute works like query, but does
not expect any results back.
</p>

<p>
You can create tables directly without the need to define a class, and in more
complicated cases, you will need to use the create-table operator. One example
would be the following:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(query (:create-table so-items
         ((item-id :type integer)
          (so-id :type (or integer db-null) :references ((so-headers id)))
          (product-id :type (or integer db-null))
          (qty :type (or integer db-null))
          (net-price :type (or numeric db-null)))
         (:primary-key item-id so-id)))

</pre>
</div>

<p>
In the above case, the new table's name will be so-items (actually in the
database it will be so_items because sql does not allow hyphens. The column
item-id is an integer and cannot be null. The column so-id is also an integer,
but is allowed to be null and is a foreign key to the id field in the so-headers
table so-headers. The primary key is actually a composite of item-id and so-id.
(If we wanted the primary key to be just item-id, we could have specified that
in the form defining item-id.) For more detail and examples on building tables
using the s-sql approach, see <a href="create-tables.html">create-tables.html</a>
</p>


<p>
Let us add a few countries:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(insert-dao (make-instance 'country :name "The Netherlands"
                                    :inhabitants 16800000
                                    :sovereign "Willem-Alexander"))
(insert-dao (make-instance 'country :name "Croatia"
                                    :inhabitants 4400000))
</pre>
</div>

<p>
Then, to update Croatia's population, we could do this:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(let ((croatia (get-dao 'country "Croatia")))
  (setf (country-inhabitants croatia) 4500000)
  (update-dao croatia))
(query (:select '* :from 'country))
;; =&gt; (("The Netherlands" 16800000 "Willem-Alexander")
;;     ("Croatia" 4500000 :NULL))
</pre>
</div>

<p>
Next, to demonstrate a bit more of the S-SQL syntax, here is the query the
utility function list-tables uses to get a list of the tables in a database:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(sql (:select 'relname :from 'pg-catalog.pg-class
      :inner-join 'pg-catalog.pg-namespace :on (:= 'relnamespace 'pg-namespace.oid)
      :where (:and (:= 'relkind "r")
                   (:not-in 'nspname (:set "pg_catalog" "pg_toast"))
                   (:pg-catalog.pg-table-is-visible 'pg-class.oid))))
;; =&gt; "(SELECT relname FROM pg_catalog.pg_class
;;      INNER JOIN pg_catalog.pg_namespace ON (relnamespace = pg_namespace.oid)
;;      WHERE ((relkind = 'r') and (nspname NOT IN ('pg_catalog', 'pg_toast'))
;;             and pg_catalog.pg_table_is_visible(pg_class.oid)))"
</pre>
</div>

<p>
sql is a macro that will simply compile a query, it can be useful for seeing
how your queries are expanded or if you want to do something unexpected with
them.
</p>

<p>
As you can see, lists starting with keywords are used to express SQL commands
and operators (lists starting with something else will be evaluated and then
inserted into the query). Quoted symbols name columns or tables (keywords can
also be used but might introduce ambiguities). The syntax supports subqueries,
multiple joins, stored procedures, etc. See the <a href="s-sql.html">S-SQL reference manual</a> for a
complete treatment.
</p>

<p>
Finally, here is an example of the use of prepared statements:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(defprepared sovereign-of
  (:select 'sovereign :from 'country :where (:= 'name '$1))
  :single!)
(sovereign-of "The Netherlands")
;; =&gt; "Willem-Alexander"
</pre>
</div>

<p>
The defprepared macro creates a function that takes the same amount of
arguments as there are $X placeholders in the given query. The query will
only be parsed and planned once (per database connection), which can be
faster, especially for complex queries.
</p>
<div class="org-src-container">
<pre class="src src-lisp">(disconnect-toplevel)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge0801c7" class="outline-2">
<h2 id="orge0801c7">Reference</h2>
<div class="outline-text-2" id="text-orge0801c7">
<p>
The reference manuals for the different components of Postmodern are kept
in separate files. For using the library in the most straightforward way,
you only really need to read the Postmodern reference and glance over the
S-SQL reference. The simple-date reference explains the time-related data
types included in Postmodern, and the CL-postgres reference might be useful
if you just want a low-level library for talking to a PostgreSQL server.
</p>

<ul class="org-ul">
<li><a href="postmodern.html">Postmodern</a></li>

<li><a href="s-sql.html">S-SQL</a></li>

<li><a href="array-notes.html">array-notes</a></li>

<li><a href="execute-file.html">Executing an file of sql statements</a></li>

<li><a href="simple-date.html">Simple-date</a></li>

<li><a href="cl-postgres.html">CL-postgres</a></li>
</ul>
</div>
</div>


<div id="outline-container-org5e002d5" class="outline-2">
<h2 id="org5e002d5">Caveats and to-dos</h2>
<div class="outline-text-2" id="text-org5e002d5">
</div>
<div id="outline-container-org126da9c" class="outline-3">
<h3 id="org126da9c">Timezones and Simple-Date</h3>
<div class="outline-text-3" id="text-org126da9c">
<p>
It is important to understand how postgresql (not postmodern) handles
timestamps and timestamps with time zones. Postgresql keeps everything
in UTC, it does not store a timezone even in a timezone aware column.
If you use a timestamp with timezone column, postgresql will calculate
the UTC time and will normalize the timestamp data to UTC. When you
later select the record, postgresql will look at the timezone for the
postgresql session, retrieve the data and then provide the data
recalculated from UTC to the timezone for that postgresql session.
There is a good writeup of timezones at
<a href="http://blog.untrod.com/2016/08/actually-understanding-timezones-in-postgresql.html">http://blog.untrod.com/2016/08/actually-understanding-timezones-in-postgresql.html</a>
and <a href="http://phili.pe/posts/timestamps-and-time-zones-in-postgresql/">http://phili.pe/posts/timestamps-and-time-zones-in-postgresql/</a>.
</p>

<p>
The Simple-date add-on library (not enabled by default)
provides types (CLOS classes) for dates, timestamps, and intervals
similar to the ones SQL databases use, in order to be able to store and read
these to and from a database in a straighforward way. A few obvious operations
are defined on these types. However, <a href="simple-date.html">Simple-date</a> has no concept of time zones.
If you need your time-keeping to be reliable and/or universal then you might consider
using another library, <a href="https://github.com/dlowe-net/local-time">local-time</a>, which solves the same problem as simple-date, but
does understand time zones. It does have some code for integrating with
cl-postgres. See
<a href="https://github.com/dlowe-net/local-time/blob/master/src/integration/cl-postgres.lisp">https://github.com/dlowe-net/local-time/blob/master/src/integration/cl-postgres.lisp</a>
</p>

<p>
To use simple-date with cl-postgres or postmodern,
load simple-date-cl-postgres-glue to register suitable SQL
readers and writers for the associated database types.
</p>
<div class="org-src-container">
<pre class="src src-lisp">
(ql:quickload :simple-date/postgres-glue)

(setf cl-postgres:*sql-readtable*
        (cl-postgres:copy-sql-readtable
         simple-date-cl-postgres-glue:*simple-date-sql-readtable*))
</pre>
</div>
<p>
To get back to the default cl-postgres reader:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(setf cl-postgres:*sql-readtable*
        (cl-postgres:copy-sql-readtable
         cl-postgres::*default-sql-readtable*))
</pre>
</div>

<p>
To use the simple-date reader when cl-postgres is using the default:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(setf cl-postgres:*sql-readtable*
        (cl-postgres:copy-sql-readtable
         simple-date-cl-postgres-glue:*simple-date-sql-readtable*))
</pre>
</div>

<p>
As a reminder for those who want to use local-time, to enable the local-time
reader:
</p>
<div class="org-src-container">
<pre class="src src-lisp">(local-time:set-local-time-cl-postgres-readers)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1f27e8" class="outline-3">
<h3 id="orgc1f27e8">Portability</h3>
<div class="outline-text-3" id="text-orgc1f27e8">
<p>
The Lisp code in Postmodern is theoretically portable across implementations,
and seems to work on all major ones as well as some minor ones such as Genera.
It is regularly tested on ccl, sbcl, ecl and cmucl.
Implementations that do not have meta-object protocol support will not have
DAOs, but all other parts of the library should work (all widely used
implementations do support this).
</p>

<p>
The library is not likely to work for PostgreSQL versions older than 8.4.
Other features only work in newer Postgresql versions as the features
were only introduced in those newer versions.
</p>
</div>
</div>

<div id="outline-container-org65e70b6" class="outline-3">
<h3 id="org65e70b6">Things that should be implemented</h3>
<div class="outline-text-3" id="text-org65e70b6">
<p>
Postmodern is under active development so Issues and feature requests should
be flagged on <a href="https://github.com/marijnh/Postmodern">Postmodern's site on github</a>.
</p>

<p>
It would be a nice feature if Postmodern could help you with defining your
database schemas and, more importantly, updating your databases when your code
changes. It would theoretically not be hard to build a function that compares
a schema on the Lisp side with the state of the database, and helps you to
interactively update your database. PostgreSQL has a quite complete
introspection system. Unfortunately it would be a lot of work to implement
this, since databases can contain so many different types of entities
(tables, views, indices, procedures, constraints, sequences, etc.) which are
all created, changed, and dropped in different ways.
</p>

<p>
Some areas that are currently under consideration can be found in the ROADMAP.md
file.
</p>
</div>
</div>
</div>

<div id="outline-container-org90487a1" class="outline-2">
<h2 id="org90487a1">Resources</h2>
<div class="outline-text-2" id="text-org90487a1">
<ul class="org-ul">
<li><a href="https://mailman.common-lisp.net/listinfo/postmodern-devel">Mailing List</a></li>
<li><a href="https://sites.google.com/site/sabraonthehill/postmodern-examples">A collection of Postmodern examples</a></li>
<li><a href="http://www.postgresql.org/docs/current/static/index.html">The PostgreSQL manuals</a></li>
<li><a href="http://www.postgresql.org/docs/current/static/protocol.html">The wire protocol Postmodern uses</a></li>
<li><a href="http://clsql.b9.com/">CLSQL</a></li>
<li><a href="https://github.com/filonenko-mikhail/cl-ewkb">Common Lisp Postgis library</a></li>
<li><a href="http://common-lisp.net/project/local-time/">Local-time</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2018-09-17 Mon 07:26</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
